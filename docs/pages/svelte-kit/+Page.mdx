import { Link, RepoLink } from '@brillout/docpress'
import { MostlyMutations } from '../../components'

Using Telefunc with [SvelteKit](https://svelte.dev/docs/kit).

## 1. Install

```bash
npm install telefunc
```

## 2. Vite plugin

```ts
// vite.config.ts

import { sveltekit } from '@sveltejs/kit/vite'
import { telefunc } from 'telefunc/vite'
import { defineConfig } from 'vite'

export default defineConfig({
  plugins: [sveltekit(), telefunc()],
})
```

## 3. Server integration

```ts
// src/routes/_telefunc/+server.ts
// Environment: server

import { telefunc } from 'telefunc'
import type { RequestHandler } from './$types'

const handler: RequestHandler = async (event) => {
  const httpResponse = await telefunc({ request: event.request })
  return new Response(httpResponse.body, {
    headers: new Headers({ 'content-type': httpResponse.contentType }),
    status: httpResponse.statusCode,
  })
}
export { handler as GET, handler as POST }
```

## 4. Create a telefunction

Create your first telefunction, for example:

```ts
// src/routes/Counter.telefunc.ts
// Environment: server

export async function onIncrement(diff: number) {
  database.value += diff
  return database.value
}
```

> `.telefunc.ts` files are always server-only, regardless of where they are located. You don't need `$lib/server` or `.server`.

Call it from the client:

```svelte
<!-- src/routes/Counter.svelte -->
<!-- Environment: client -->

<script lang="ts">
import { onIncrement } from './Counter.telefunc'

let count = 0
</script>

<button on:click={async () => { count = await onIncrement(+1) }}>+1</button>
<span>{count}</span>
```

> To pass contextual information (e.g. the logged-in user) to your telefunctions, see <Link href="/getContext" />.

## Example

<RepoLink path="/examples/svelte-kit" />

## Initial Data

<MostlyMutations
  toolName="SvelteKit"
  builtInMechanism={
    <p>
      For example, we can use SvelteKit's <code>load</code> function in a <code>+page.server.js</code> file to fetch
      initial data directly from a database, see{' '}
      <a href="https://svelte.dev/docs/kit/load#Universal-vs-server">
        SvelteKit Docs &gt; Loading data &gt; Universal vs server
      </a>
      {'.'}
    </p>
  }
/>
